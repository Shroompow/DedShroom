<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: state.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: state.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const discord = require('discord.js');
const constants = require('./constants.js');
class State {
	/**
	 * Constructs State
	 */
	constructor(){
		/**All modules stored as name => Module */
		this.modules = {};
		/**All known guilds stored as guildID => Guild */
		this.guilds = {};
		/**All known users stored as userID => User */
		this.users = {};
		/**All active sessions stored as sessionID => Session */
		this.sessions = {};
		this.indexes = {};
		/**All languages stored as name => {} */
		this.languages = {};
		/**Name of the default language */
		this.defaultLanguage = "";
		/**Is the state running? */
		this.running = false;
	}
	/**
	 * Starts the BotState.
	 * This includes loading Indexes, Languages, Modules, etc.
	 * And initializing them.
	 * @param {string} token The token to login with
	 */
	start(token){
		return Promise((resolve,reject)=>{
			if(this.running){resolve();return;}
			console.log("Starting State");
			//Loading indexes
			var languagesIndex;
			var modulesIndex;
			try{
				console.log("Loading LanguageIndex");
				languagesIndex = this.indexes["languages"] = require(constants.FILE_LANGUAGES);
				console.log("Loading ModuleIndex");
				modulesIndex = this.indexes["modules"] = require(constants.FILE_MODULES);
			}catch(e){
				console.error("Error on loading Indexes",e.message);
				reject();
				return;
			}

			try{
				console.log("Loading Languages");
				//Processing LanguageIndex
				for(var k in languagesIndex){
					//hasOwnProperty to check if the property wasn't inherited from a baseclass
					if(languagesIndex.hasOwnProperty(k)){
						if(k=="default"){
							this.defaultLanguage = languagesIndex[k];
						}else{
							this.languages[k] = require(constants.DIR_LANG+languagesIndex[k]);
						}
					}
				}
			}catch(e){
				console.error(`Error on loading language-file`,e.message);
				reject();
				return;
			}

			try{
				console.log("Loading Modules");
				//Processing ModuleIndex
				for(var k in modulesIndex){
					//hasOwnProperty to check if the property wasn't inherited from a baseclass
					if(modulesIndex.hasOwnProperty(k)){
						var mx = modulesIndex[k];
						var mclass = require(constants.DIR_MODULES+mx.name);
						this.modules[mx.name] = new mclass(mx.name,mx.displayName,mx.nsfw);
					}
				}
			}catch(e){
				console.error(`Error on loading module`,e.message);
				reject();
				return;
			}

			console.log("Initializing Modules");
			for(var k in this.modules){
				this.modules[k].init(this);
			}

			console.log("PostInitializing Modules")
			for(var k in this.modules){
				this.modules[k].postInit();
			}

			this.running = true;
			resolve();
		});
	}
	/**
	 * Tries to exit the BotState.
	 * Modules and Sessions will be terminated.
	 * @param {boolean} force Forces the bot to terminate. This might result in data loss.
	 */
	exit(force=false){
		return Promise((resolve)=>{
			if(!this.running){resolve();}

			console.log(`Exiting State (force:${force})`);

			if(!force){
				for(var k in this.modules){
					this.modules[k].exit();
				}
				this.modules = {};
			}

			this.running = false;
			resolve();
		});
	}
}
module.exports = State;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="CommandData.html">CommandData</a></li><li><a href="Logger.html">Logger</a></li><li><a href="LogManager.html">LogManager</a></li><li><a href="Module.html">Module</a></li><li><a href="State.html">State</a></li></ul><h3>Global</h3><ul><li><a href="global.html#format">format</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Mon Jul 09 2018 20:14:32 GMT+0200 (Mitteleurop√§ische Sommerzeit)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
